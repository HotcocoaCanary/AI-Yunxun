server:
  port: 8080

spring:
  application:
    name: AI-Yunxun
  main:
    allow-circular-references: true

  # ==========================
  # MySQL Database
  # ==========================
  datasource:
    url: jdbc:mysql://localhost:3306/ai_yunxun?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
    username: ai_yunxun
    password: ai_yunxun
    driver-class-name: com.mysql.cj.jdbc.Driver

  jpa:
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect

  data:
    # ==========================
    # MongoDB
    # ==========================
    mongodb:
      host: localhost
      port: 27017
      username: ai_yunxun
      password: ai_yunxun
      authentication-database: admin
      database: ai_yunxun
    # ==========================
    # Redis
    # ==========================
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 3000ms
      password: ai_yunxun

  # ==========================
  # Neo4j
  # ==========================
  neo4j:
    uri: bolt://localhost:7687
    authentication:
      username: neo4j
      password: ai_yunxun

  ai:
    # Ollama 配置（已替换为智谱AI API）
    # ollama:
    #   base-url: http://localhost:11434
    #   chat:
    #     options:
    #       model: qwen3:8b
    # 智谱AI 配置
    zhipu:
      api-key: da2a344e9ab04b5da76e7e352893b412.AjEnXNNc2YG0aBHm
      model: glm-4.5-flash
    mcp:
      # ==========================
      # MCP 服务器配置（本地工具）
      # ==========================
      server:
        enabled: true
        name: mcp-server
        version: 1.0.0
        # SSE 端点配置（用于 WebFlux 响应式传输）
        sse-endpoint: /sse
        sse-message-endpoint: /mcp/message
        capabilities:
          tool: true      # 启用工具能力
          resource: true  # 启用资源能力
          prompt: true    # 启用提示词能力
      # ==========================
      # MCP 客户端配置（连接外部服务器）
      # ==========================
      client:
        # 注意：Spring AI MCP Client AutoConfig 会在容器初始化阶段创建并可能初始化连接；
        # 若配置成“自连自身端口”，容易触发启动时序问题（Connection refused / 超时）。
        # 这里默认关闭 AutoConfig，改用项目内的 ApplicationReadyEvent 引导连接（见 yunxun.mcp.local-client）。
        enabled: false
        initialized: false
        toolcallback:
          # 关闭“把 MCP Client 的远程工具转换为 Spring AI ToolCallback”的自动注册：
          # 若开启该功能，MCP Server 启动时会调用 client.listTools() 做工具发现，从而在端口未监听/上游未启动时导致启动失败
          enabled: false
yunxun:
  mcp:
    local-client:
      enabled: true
      sse-endpoint: /sse
# ==========================
# Web Search（可选）
# ==========================
# web_search 工具的开关与上游 MCP 搜索服务配置（默认关闭）
web:
  search:
    enabled: true
    mcp:
      # 上游 MCP 连接方式：sse 或 stdio
      mode: sse
      # mode=sse 时：外部 MCP 搜索服务地址（只写基地址，不要带 /sse）
      # url: http://localhost:8081
      # sse-endpoint: /sse
      #
      # mode=stdio 时：本机启动 mcp-searxng（它需要一个可用的 searxng 实例地址）
      # command: mcp-searxng
      # searxng-url: http://localhost:8082
      tool-name: web_search

# ==========================
# Logging
# ==========================
logging:
  level:
    root: INFO
    com.example: INFO
    io.lettuce.core: INFO
    org.mongodb.driver: INFO
    org.neo4j.driver: INFO
    io.modelcontextprotocol: TRACE
    org.springframework.ai.mcp: TRACE
  file:
    name: logs/app.log
