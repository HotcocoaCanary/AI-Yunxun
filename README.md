# AI-Yunxun 智能知识图谱系统

基于图数据库和自然语言实现的学术论文知识图谱系统，提供智能问答、知识图谱可视化、数据分析等功能。

## 📋 项目简介

AI-Yunxun 是一个集成了大语言模型（LLM）和知识图谱的智能查询系统，通过自然语言交互，帮助用户查询和分析学术论文知识图谱。系统采用前后端分离架构，后端基于 Spring Boot + Spring AI，前端基于 Next.js，通过 MCP（Model Context Protocol）协议实现 AI 模型与工具的无缝集成。

## ✨ 核心特性

### 🤖 智能问答
- **自然语言查询**: 支持用自然语言提问，系统自动理解意图
- **两阶段处理**: 工具调用 + 自然语言生成，确保回答准确且易读
- **多模态响应**: 同时返回文本回答、图谱数据和图表可视化

### 🕸️ 知识图谱可视化
- **交互式图谱**: 基于 ECharts 的力导向图，支持拖拽、缩放、点击交互
- **实时查询**: 通过 Neo4j 图数据库实时查询实体和关系
- **动态渲染**: 根据查询结果动态生成图谱可视化

### 📊 数据分析
- **多种图表类型**: 支持柱状图、折线图、饼图、力导向图等
- **ECharts 集成**: 基于 ECharts 的强大可视化能力
- **智能洞察**: 自动生成数据洞察摘要和要点

### 🔧 MCP 工具集成
- **标准化工具**: 通过 MCP 协议将后端能力封装为工具
- **自动调用**: AI 模型根据用户问题自动选择合适的工具
- **可扩展性**: 易于添加新的工具和功能
- **网络搜索**: 集成 websearch-mcp，支持实时网络搜索和数据获取

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────┐
│                      前端层 (Next.js)                        │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │ ChatPanel    │  │ GraphPanel   │  │ ChartPanel   │      │
│  │ 对话界面     │  │ 图谱可视化   │  │ 图表展示     │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ HTTP API
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      后端层 (Spring Boot)                     │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  McpChatController                                   │   │
│  │  POST /api/chat                                      │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                 │
│                            ▼                                 │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  McpChatService                                       │   │
│  │  - 两阶段对话处理                                     │   │
│  │  - 工具调用协调                                       │   │
│  └──────────────────────────────────────────────────────┘   │
│                            │                                 │
│        ┌───────────────────┼───────────────────┐              │
│        ▼                   ▼                   ▼              │
│  ┌──────────┐      ┌──────────┐      ┌──────────┐          │
│  │ Neo4j    │      │ Chart   │      │ MongoDB  │          │
│  │ GraphTool│      │ Tool    │      │ Tool     │          │
│  └──────────┘      └──────────┘      └──────────┘          │
└─────────────────────────────────────────────────────────────┘
                            │
                            │ MCP Protocol
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    AI 模型层 (Ollama)                         │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  qwen3:8b                                            │   │
│  │  - 自然语言理解                                      │   │
│  │  - 工具调用决策                                      │   │
│  │  - 自然语言生成                                      │   │
│  └──────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层                                │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  Neo4j   │  │ MongoDB  │  │  MySQL   │  │  Redis   │   │
│  │ 图谱数据 │  │ 论文文档  │  │ 业务数据 │  │  缓存    │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 快速开始

### 环境要求

- **Docker**: 20.10+
- **Docker Compose**: 2.0+

> 💡 使用 Docker 可以一键启动所有服务，包括数据库、AI 模型、后端和前端，无需手动配置环境。

### 一键启动（推荐）

#### 1. 克隆项目

```bash
git clone <repository-url>
cd AI-Yunxun
```

#### 2. 启动所有服务

```bash
docker-compose up -d
```

这个命令会启动以下服务：
- **数据库服务**: MySQL, MongoDB, Redis, Neo4j
- **AI 模型**: Ollama (qwen3:8b)
- **后端服务**: Spring Boot 应用 (端口 8080)
- **前端服务**: Next.js 应用 (端口 3000)

#### 3. 查看服务状态

```bash
docker-compose ps
```

#### 4. 查看日志

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f frontend
```

#### 5. 访问应用

等待所有服务启动完成后（约 1-2 分钟），打开浏览器访问：

- **前端界面**: http://localhost:3000
- **后端 API**: http://localhost:8080
- **Neo4j 浏览器**: http://localhost:7474
- **Ollama API**: http://localhost:11434

### 服务说明

#### 数据库服务

所有数据库服务已自动配置，默认账号密码均为 `ai_yunxun`：

- **MySQL**: `localhost:3306` (用户: `ai_yunxun`, 密码: `ai_yunxun`)
- **MongoDB**: `localhost:27017` (用户: `ai_yunxun`, 密码: `ai_yunxun`)
- **Redis**: `localhost:6379` (密码: `ai_yunxun`)
- **Neo4j**: `localhost:7687` (用户: `neo4j`, 密码: `ai_yunxun`)

#### AI 模型

Ollama 服务会自动下载并启动 `qwen3:8b` 模型，首次启动可能需要几分钟下载模型文件。

#### 网络搜索（可选）

系统已配置 `mcp-searxng` 支持网络搜索功能（无需 API Key）。要启用搜索功能：

1. **安装 mcp-searxng**（在宿主机上）：
   ```bash
   npm install -g mcp-searxng
   ```

2. **配置已自动启用**：`application.yml` 中的配置已启用

3. **重启后端服务**：搜索工具会自动注册

> 💡 **提示**：`mcp-searxng` 使用公共 SearXNG 实例，无需 API Key，开箱即用。

### 常用命令

```bash
# 停止所有服务
docker-compose down

# 停止并删除数据卷（⚠️ 会删除所有数据）
docker-compose down -v

# 重启特定服务
docker-compose restart backend
docker-compose restart frontend

# 重新构建并启动
docker-compose up -d --build

# 查看资源使用情况
docker-compose stats
```

### 手动启动（开发模式）

如果你需要手动启动服务进行开发，请参考：

#### 环境要求

- **Java**: 17+
- **Node.js**: 18+
- **Maven**: 3.6+

#### 启动步骤

1. **启动数据库服务**（使用 Docker Compose）:
   ```bash
   docker-compose up -d mysql mongodb redis neo4j ollama
   ```

2. **配置后端**:
   编辑 `backend/src/main/resources/application.yml`，确保数据库连接配置正确。

3. **启动后端**:
   ```bash
   cd backend
   mvn spring-boot:run
   ```

4. **启动前端**:
   ```bash
   cd frontend
   npm install
   npm run dev
   ```

详细的手动配置说明请参考 [后端文档](./backend/README.md) 和 [前端文档](./frontend/README.md)。

## 📖 使用指南

### 智能问答

1. 在聊天界面输入自然语言问题
2. 系统会自动分析意图并调用相应的工具
3. 返回结果包括：
   - 自然语言回答
   - 图谱数据（如果涉及实体关系）
   - 图表数据（如果涉及数据分析）

**示例问题**:
- "Bob 认识谁？" - 查询图谱关系
- "近10年考研人数变化趋势，画一个柱状图" - 生成图表
- "查找与机器学习相关的所有论文" - 图谱查询

### 知识图谱

当问题涉及实体和关系时，系统会自动：
1. 调用 Neo4j 图谱工具查询数据
2. 将结果转换为图谱可视化格式
3. 在右侧图谱面板中展示交互式图谱

### 图表展示

当问题涉及数据分析时，系统会：
1. 调用图表生成工具
2. 生成 ECharts 格式的图表配置
3. 在右侧图表面板中展示可视化图表

## 🛠️ 技术栈

### 后端技术
- **框架**: Spring Boot 3.5.7
- **AI 框架**: Spring AI 1.0.3
- **协议**: MCP (Model Context Protocol)
- **数据库**:
  - Neo4j (知识图谱)
  - MongoDB (文档存储)
  - MySQL (关系数据)
  - Redis (缓存)
- **AI 模型**: Ollama (qwen3:8b)

### 前端技术
- **框架**: Next.js 16.0.7
- **UI 库**: React 19.2.0
- **样式**: Tailwind CSS 4
- **图表**: ECharts 5.5.0
- **语言**: TypeScript 5

## 📁 项目结构

```
AI-Yunxun/
├── backend/                 # 后端服务
│   ├── src/main/java/       # Java 源码
│   │   └── yunxun/ai/canary/backend/
│   │       ├── mcp/         # MCP 客户端和服务器
│   │       ├── graph/        # 图表服务
│   │       └── db/          # 数据库访问
│   ├── src/main/resources/  # 配置文件
│   └── README.md            # 后端详细文档
│
├── frontend/                # 前端应用
│   ├── app/                 # Next.js App Router
│   │   ├── chat/           # 聊天页面
│   │   └── api/            # API 路由
│   ├── components/         # React 组件
│   │   ├── chat/           # 聊天组件
│   │   ├── graph/          # 图谱组件
│   │   └── chart/          # 图表组件
│   └── README.md           # 前端详细文档
│
└── README.md                # 本文档
```

## 🔄 核心流程

### 对话处理流程

```
用户输入问题
    │
    ▼
前端 ChatPanel
    │
    ▼
POST /api/chat
    │
    ▼
后端 McpChatController
    │
    ▼
McpChatService.chat()
    │
    ├─► 阶段一: 工具调用
    │   │
    │   ├─► AI 模型分析意图
    │   │
    │   ├─► 调用 MCP 工具
    │   │   ├─► Neo4jGraphTool (查询图谱)
    │   │   ├─► GraphChartTool (生成图表)
    │   │   └─► MongoTool (存储文档)
    │   │
    │   └─► 提取 GRAPH_JSON/CHART_JSON
    │
    └─► 阶段二: 自然语言生成
        │
        ├─► 基于工具结果生成回答
        │
        └─► 返回结构化响应
            ├─► reply: 自然语言回答
            ├─► graphJson: 图谱数据
            └─► chartJson: 图表数据
```

## 📚 详细文档

- [后端架构文档](./backend/README.md) - 后端详细结构设计
- [前端架构文档](./frontend/README.md) - 前端详细结构设计

## 🐛 故障排除

### 常见问题

1. **端口冲突**
   - 确保 8080 和 3000 端口未被占用
   - 可在配置文件中修改端口

2. **数据库连接失败**
   - 检查数据库服务是否启动
   - 验证连接配置是否正确

3. **AI 模型不可用**
   - 确保 Ollama 服务运行在 `http://localhost:11434`
   - 确认已安装 qwen3:8b 模型

4. **前端无法连接后端**
   - 检查后端服务是否正常运行
   - 验证 API 代理配置

### 日志查看

- **后端日志**: `backend/logs/app.log`
- **前端日志**: 浏览器开发者工具 Console

## 🚧 开发计划

### 已完成 ✅
- 基础架构搭建
- MCP 工具集成
- 两阶段对话处理
- 图谱可视化
- 图表生成

### 进行中 🚧
- 真实数据源集成
- 更多图表类型支持
- 性能优化

### 计划中 📋
- 向量检索（Chroma）
- 智能查询服务
- 数据爬取服务
- 用户认证系统

## 📄 许可证

MIT License

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进项目。

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 项目 Issues: [GitHub Issues](https://github.com/your-repo/issues)
- 邮箱: your-email@example.com

---

**AI-Yunxun** - 让知识图谱更智能，让数据更易理解！
