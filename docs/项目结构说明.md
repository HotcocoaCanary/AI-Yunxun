# é¡¹ç›®ç»“æ„è¯´æ˜

## ModelåŒ…ç»“æ„

é¡¹ç›®é‡‡ç”¨äº†DTOå’ŒEntityåˆ†ç¦»çš„æ¶æ„è®¾è®¡ï¼Œå°†æ•°æ®æ¨¡å‹åˆ†ä¸ºä¸¤ä¸ªå­åŒ…ï¼š

### ğŸ“ ç›®å½•ç»“æ„

```
src/main/java/yunxun/ai/canary/backend/model/
â”œâ”€â”€ entity/          # å®ä½“ç±»ï¼ˆæ•°æ®åº“æ˜ å°„ï¼‰
â”‚   â”œâ”€â”€ User.java
â”‚   â”œâ”€â”€ Paper.java
â”‚   â”œâ”€â”€ KnowledgeEntity.java
â”‚   â”œâ”€â”€ Relationship.java
â”‚   â””â”€â”€ QueryLog.java
â””â”€â”€ dto/             # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”œâ”€â”€ ApiResponseDTO.java
    â”œâ”€â”€ UserDTO.java
    â”œâ”€â”€ RegisterRequestDTO.java
    â”œâ”€â”€ LoginRequestDTO.java
    â”œâ”€â”€ QueryRequestDTO.java
    â”œâ”€â”€ QueryResponseDTO.java
    â”œâ”€â”€ PaperDTO.java
    â””â”€â”€ KnowledgeEntityDTO.java
```

### ğŸ—ï¸ æ¶æ„è®¾è®¡åŸåˆ™

#### Entityï¼ˆå®ä½“ç±»ï¼‰
- **ç”¨é€”**: ç›´æ¥æ˜ å°„æ•°æ®åº“è¡¨ç»“æ„
- **ç‰¹ç‚¹**: 
  - åŒ…å«JPA/Neo4j/MongoDBæ³¨è§£
  - ä¸æ•°æ®åº“è¡¨ä¸€ä¸€å¯¹åº”
  - åŒ…å«å®Œæ•´çš„ä¸šåŠ¡å­—æ®µ
  - ç”¨äºæ•°æ®æŒä¹…åŒ–æ“ä½œ

#### DTOï¼ˆæ•°æ®ä¼ è¾“å¯¹è±¡ï¼‰
- **ç”¨é€”**: ç”¨äºAPIæ¥å£çš„æ•°æ®ä¼ è¾“
- **ç‰¹ç‚¹**:
  - ä¸åŒ…å«æ•°æ®åº“æ³¨è§£
  - åªåŒ…å«å‰ç«¯éœ€è¦çš„å­—æ®µ
  - æ”¯æŒæ•°æ®éªŒè¯æ³¨è§£
  - æä¾›å®ä½“è½¬æ¢æ–¹æ³•

### ğŸ”„ è½¬æ¢æœºåˆ¶

#### Entity â†’ DTO
```java
// ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•
UserDTO userDTO = UserDTO.fromEntity(user);
```

#### DTO â†’ Entity
```java
// ä½¿ç”¨toEntityæ–¹æ³•
User user = userDTO.toEntity();
```

### ğŸ“‹ DTOåˆ†ç±»

#### 1. è¯·æ±‚DTOï¼ˆRequest DTOï¼‰
- `RegisterRequestDTO` - ç”¨æˆ·æ³¨å†Œè¯·æ±‚
- `LoginRequestDTO` - ç”¨æˆ·ç™»å½•è¯·æ±‚
- `QueryRequestDTO` - æŸ¥è¯¢è¯·æ±‚

#### 2. å“åº”DTOï¼ˆResponse DTOï¼‰
- `UserDTO` - ç”¨æˆ·ä¿¡æ¯å“åº”
- `PaperDTO` - è®ºæ–‡ä¿¡æ¯å“åº”
- `KnowledgeEntityDTO` - çŸ¥è¯†å®ä½“å“åº”
- `QueryResponseDTO` - æŸ¥è¯¢ç»“æœå“åº”

#### 3. é€šç”¨DTO
- `ApiResponseDTO<T>` - ç»Ÿä¸€APIå“åº”æ ¼å¼

### ğŸ¯ ä¼˜åŠ¿

1. **èŒè´£åˆ†ç¦»**: Entityä¸“æ³¨æ•°æ®æŒä¹…åŒ–ï¼ŒDTOä¸“æ³¨æ•°æ®ä¼ è¾“
2. **å®‰å…¨æ€§**: DTOå¯ä»¥éšè—æ•æ„Ÿå­—æ®µï¼Œé¿å…æ•°æ®æ³„éœ²
3. **çµæ´»æ€§**: å¯ä»¥ç‹¬ç«‹ä¿®æ”¹DTOç»“æ„è€Œä¸å½±å“æ•°æ®åº“
4. **éªŒè¯**: DTOæ”¯æŒæ•°æ®éªŒè¯ï¼Œæé«˜æ¥å£å®‰å…¨æ€§
5. **ç‰ˆæœ¬æ§åˆ¶**: å¯ä»¥ç»´æŠ¤ä¸åŒç‰ˆæœ¬çš„DTOï¼Œæ”¯æŒAPIæ¼”è¿›

### ğŸ“ ä½¿ç”¨ç¤ºä¾‹

#### Controllerå±‚ä½¿ç”¨DTO
```java
@PostMapping("/register")
public ResponseEntity<ApiResponseDTO<UserDTO>> register(
    @Valid @RequestBody RegisterRequestDTO request) {
    
    User user = userService.registerUser(
        request.getUsername(),
        request.getEmail(),
        request.getPassword(),
        request.getFullName()
    );
    
    UserDTO userDTO = UserDTO.fromEntity(user);
    return ResponseEntity.ok(ApiResponseDTO.success("æ³¨å†ŒæˆåŠŸ", userDTO));
}
```

#### Serviceå±‚ä½¿ç”¨Entity
```java
@Service
public class UserService {
    
    public User registerUser(String username, String email, 
                           String password, String fullName) {
        User user = new User();
        user.setUsername(username);
        user.setEmail(email);
        user.setPassword(passwordEncoder.encode(password));
        user.setFullName(fullName);
        return userRepository.save(user);
    }
}
```

### ğŸ”§ æœ€ä½³å®è·µ

1. **å‘½åè§„èŒƒ**: DTOä»¥`DTO`ç»“å°¾ï¼ŒEntityä»¥ä¸šåŠ¡åç§°å‘½å
2. **åŒ…ç»“æ„**: æŒ‰åŠŸèƒ½æ¨¡å—åˆ†åŒ…ï¼Œä¾¿äºç®¡ç†
3. **è½¬æ¢æ–¹æ³•**: æä¾›é™æ€å·¥å‚æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•
4. **éªŒè¯æ³¨è§£**: åœ¨DTOä¸Šæ·»åŠ æ•°æ®éªŒè¯æ³¨è§£
5. **æ–‡æ¡£æ³¨é‡Š**: ä¸ºæ¯ä¸ªDTOæ·»åŠ è¯¦ç»†çš„æ–‡æ¡£è¯´æ˜

è¿™ç§æ¶æ„è®¾è®¡ä½¿å¾—é¡¹ç›®æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤ï¼ŒåŒæ—¶æä¾›äº†è‰¯å¥½çš„æ‰©å±•æ€§ã€‚
