# AI-云寻（AI-Yunxun）项目介绍

## 项目概述

**AI-云寻（AI-Yunxun）** 是一个基于MCP（Model Context Protocol）协议的毕业设计项目，核心目标是使用MCP协议技术拓宽大模型能力，使其在检索和关系分析中具有更加出色的表现。

## 核心目标

通过MCP协议，将大模型与各种工具和服务进行连接，实现：
- **智能检索**：调用网络检索工具获取相关信息
- **关系分析**：从检索结果中提取和分析实体关系
- **知识图谱**：将关系信息持久化存储到Neo4j图数据库
- **可视化分析**：使用EChart生成多种类型的图表辅助分析
- **智能问答**：基于知识图谱和图表可视化回答用户问题

## 典型应用场景

### 示例问题
**"中国科研机构发表过哪些关于甜菜的论文？"**

### 系统工作流程

1. **信息检索阶段**
   - 大模型调用网络检索MCP工具
   - 检索关于"中国科研机构"和"甜菜论文"的相关信息

2. **关系分析阶段**
   - 从检索结果中提取实体（科研机构、论文、作者等）
   - 分析实体之间的关系（发表关系、合作关系等）
   - 识别关键信息（论文标题、机构名称、发表时间等）

3. **数据存储阶段**
   - 将提取的实体和关系保存到Neo4j图数据库
   - 构建知识图谱，形成可查询的关系网络

4. **信息查询阶段**
   - 从Neo4j关系库中查询相关信息
   - 检索符合条件的科研机构和论文

5. **可视化展示阶段**
   - 使用EChart生成多种图表：
     - **线型图**：展示论文发表时间趋势
     - **柱状图**：展示各机构论文数量对比
     - **饼图**：展示论文主题分布
     - **关系图**：展示机构、论文、作者之间的关系网络

6. **智能回答阶段**
   - 大模型基于查询结果和图表数据生成回答
   - 回答中嵌入图表分析和关系图
   - 提供结构化的信息展示

## 系统架构

### 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                    Next.js WebApp                        │
│  ┌──────────────────────────────────────────────────┐   │
│  │          MCP Client (TypeScript)                  │   │
│  │  - 连接大模型                                      │   │
│  │  - 管理MCP服务器连接                                │   │
│  │  - 工具调用协调                                     │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │           前端界面 (React + TypeScript)            │   │
│  │  - 用户交互界面                                     │   │
│  │  - 图表展示 (EChart)                               │   │
│  │  - 对话界面                                        │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                        │
                        │ MCP Protocol
                        │
        ┌───────────────┴───────────────┐
        │                                 │
┌───────▼────────┐            ┌──────────▼──────────┐
│  Neo4j MCP     │            │  EChart MCP Server   │
│  Server        │            │                     │
│  (Spring AI)   │            │  (Spring AI)        │
└───────┬────────┘            └─────────────────────┘
        │
        │
┌───────▼────────┐
│   Neo4j        │
│   数据库        │
└────────────────┘

        ┌──────────────────────┐
        │  其他MCP服务器         │
        │  (网络检索等)          │
        └──────────────────────┘
```

### 技术栈

#### 后端MCP服务器（Spring AI）
- **框架**：Spring Boot 3.5.9
- **MCP框架**：Spring AI 1.1.2
- **构建工具**：Maven
- **Java版本**：17

#### 前端Web应用（Next.js）
- **框架**：Next.js 16.1.1
- **语言**：TypeScript
- **UI库**：React 19.2.3
- **图表库**：EChart
- **MCP Client**：自定义实现（TypeScript）

#### 数据存储
- **图数据库**：Neo4j
- **连接方式**：Neo4j Java Driver

## 模块说明

### 1. Neo4j MCP Server

**位置**：`services/mcp/server/neo4j/`

**功能**：
- 提供Neo4j数据库操作工具
- 通过Cypher语句实现所有数据库操作（增删改查）
- 提供专门的图谱查询方法

**MCP工具能力**：
- `execute_cypher`：执行Cypher语句（支持增删改查所有操作）
  - 创建节点和关系：`CREATE`语句
  - 更新数据：`SET`、`MERGE`语句
  - 删除数据：`DELETE`、`DETACH DELETE`语句
  - 查询数据：`MATCH`、`RETURN`语句
- `query_graph`：查询图谱（提供额外的图谱查询方法）
  - 获取节点及其关系：查询节点及其直接关联的关系和节点
  - 路径查询：查找两个节点之间的路径
  - 模式匹配：根据特定的图模式查询匹配的子图

### 2. EChart MCP Server

**位置**：`services/mcp/server/echart/`

**功能**：
- 提供EChart图表生成工具
- 输入规范化的数据格式
- 输出可运行的HTML代码（打开即可查看图表）

**架构设计（分层处理）**：

#### 数据输入层
- **输入格式**：规范化的JSON数据
  ```json
  {
    "chartType": "line|bar|graph",
    "title": "图表标题",
    "data": { /* 图表数据 */ },
    "options": { /* 可选配置项 */ }
  }
  ```

#### 图表类型层（返回ECharts配置JSON）
- **功能**：将规范化数据转换为ECharts标准配置JSON
- **输出**：ECharts配置对象（option）的JSON格式

**MCP工具能力**：
- `generate_line_chart_config`：生成线型图配置
  - **输入**：线型图数据（x轴数据、y轴数据、系列数据等）
  - **处理**：数据验证、格式转换、配置生成
  - **输出**：ECharts线型图配置JSON
  ```json
  {
    "title": { "text": "图表标题" },
    "xAxis": { "type": "category", "data": [...] },
    "yAxis": { "type": "value" },
    "series": [{ "type": "line", "data": [...] }]
  }
  ```

- `generate_bar_chart_config`：生成柱状图配置
  - **输入**：柱状图数据（类别、数值等）
  - **处理**：数据验证、格式转换、配置生成
  - **输出**：ECharts柱状图配置JSON
  ```json
  {
    "title": { "text": "图表标题" },
    "xAxis": { "type": "category", "data": [...] },
    "yAxis": { "type": "value" },
    "series": [{ "type": "bar", "data": [...] }]
  }
  ```

- `generate_relation_graph_config`：生成关系图配置
  - **输入**：关系图数据（节点nodes、边links）
  - **处理**：数据验证、格式转换、配置生成
  - **输出**：ECharts关系图配置JSON
  ```json
  {
    "title": { "text": "关系图标题" },
    "series": [{
      "type": "graph",
      "layout": "force",
      "data": [...],  // 节点数据
      "links": [...]   // 边数据
    }]
  }
  ```

#### HTML生成层（基础层）
- **功能**：将ECharts配置JSON转换为完整的HTML文件
- **MCP工具**：`generate_html`
  - **输入**：ECharts配置JSON（来自图表类型层）
  - **处理**：
    - 验证配置JSON格式
    - 生成HTML模板（包含ECharts库引用）
    - 嵌入ECharts配置
    - 添加图表容器和初始化代码
  - **输出**：完整的HTML文件（可直接在浏览器打开）
  ```html
  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
  </head>
  <body>
    <div id="chart" style="width: 800px; height: 600px;"></div>
    <script>
      var chart = echarts.init(document.getElementById('chart'));
      var option = { /* ECharts配置JSON */ };
      chart.setOption(option);
    </script>
  </body>
  </html>
  ```

**工作流程**：
```
规范化数据输入
    ↓
图表类型层处理
    ↓
生成ECharts配置JSON
    ↓
HTML生成器接收配置JSON
    ↓
生成完整HTML文件
```

**实现特点**：
- **分层架构**：数据处理、配置生成、HTML生成分离
- **标准化接口**：图表类型层统一返回ECharts配置JSON格式
- **可扩展性**：新增图表类型只需添加新的配置生成工具
- **可复用性**：HTML生成器可复用，支持所有图表类型
- **数据验证**：每层都有数据验证和错误处理
- **模块化设计**：每个图表类型独立处理，便于维护

### 3. Next.js WebApp

**位置**：`apps/web/`

**功能**：
- MCP Client实现：连接和管理MCP服务器
- 大模型接入：集成大模型API
- 用户界面：提供对话和可视化界面
- 图表展示：使用EChart展示生成的图表

**核心组件**：
- **MCP Client**：实现MCP协议客户端，连接MCP服务器
- **对话界面**：用户与大模型交互的界面
- **图表展示**：展示EChart生成的HTML图表（通过iframe或HTML渲染）
- **用户管理**：简单的用户功能（后续实现）
- **聊天功能**：聊天记录管理（后续实现）

## 工作流程详解

### 完整交互流程

```
用户提问
    ↓
Next.js WebApp (MCP Client)
    ↓
大模型分析问题，决定调用工具
    ↓
┌─────────────────────────────────────┐
│  1. 调用网络检索MCP工具                │
│     → 获取相关信息                    │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  2. 调用Neo4j MCP工具                │
│     → 分析关系                        │
│     → 保存到Neo4j数据库               │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  3. 从Neo4j查询相关信息               │
│     → 获取实体和关系数据               │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  4. 调用EChart MCP工具                │
│     → 图表类型层：输入规范化数据       │
│     → 生成ECharts配置JSON            │
│     → HTML生成器：接收配置JSON        │
│     → 生成可运行的HTML代码            │
│     → 返回HTML文件                    │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│  5. 大模型生成回答                    │
│     → 整合查询结果                │
│     → 嵌入图表分析                    │
│     → 生成结构化回答                  │
└─────────────────────────────────────┘
    ↓
Next.js WebApp展示
    ↓
用户看到回答和图表
```

## 开发重点

### 自研模块

1. **Neo4j MCP Server**
   - 使用Spring AI框架开发
   - 实现Cypher语句执行工具（支持增删改查）
   - 提供专门的图谱查询方法
   - 通过Neo4j Java Driver连接数据库

2. **EChart MCP Server**
   - 使用Spring AI框架开发
   - 分层架构设计：
     - **图表类型层**：将规范化数据转换为ECharts配置JSON
       - 支持线型图、柱状图、关系图等图表类型
       - 每种图表类型返回标准化的ECharts配置JSON
     - **HTML生成层**：将ECharts配置JSON转换为完整HTML文件
       - 可复用的HTML模板生成器
       - 支持所有图表类型
   - 输入规范化数据，输出可运行的HTML代码

### 集成模块

1. **网络检索MCP**
   - 连接现有的MCP服务器
   - 不自行开发，使用第三方服务

2. **Next.js MCP Client**
   - 实现最简单的MCP Client
   - 支持连接多个MCP服务器
   - 协调工具调用

## 技术特点

1. **模块化设计**
   - MCP服务器独立开发和部署
   - 使用Maven父子模块管理
   - 便于扩展和维护

2. **协议标准化**
   - 基于MCP协议，易于集成
   - 支持连接第三方MCP服务器
   - 工具调用标准化

3. **前后端一体化**
   - Next.js同时作为前后端
   - 简化部署和维护
   - 统一的TypeScript技术栈

4. **可视化增强**
   - 图表辅助理解
   - 关系图直观展示
   - 数据可视化分析

## 项目结构

```
AI-Yunxun/
├── apps/
│   └── web/                      # Next.js WebApp
│       ├── app/                  # Next.js应用
│       ├── components/           # React组件
│       │   ├── mcp-client/       # MCP Client实现
│       │   ├── chat/             # 聊天界面
│       │   └── charts/           # 图表展示
│       └── package.json
├── services/
│   └── mcp/                      # MCP服务器模块
│       ├── pom.xml               # 父POM
│       └── server/
│           ├── neo4j/            # Neo4j MCP Server
│           └── echart/        # EChart MCP Server
├── docker/
│   └── docker-compose.yml        # Docker配置
└── doc/                          # 文档
    ├── 架构设计.md
    └── 项目介绍.md
```

## 开发计划

### 阶段1：基础框架搭建
- [x] Maven多模块项目结构
- [ ] Neo4j MCP Server基础框架
- [ ] EChart MCP Server基础框架
- [ ] Next.js项目基础结构

### 阶段2：核心功能开发
- [ ] Neo4j MCP工具实现
- [ ] EChart MCP工具实现
- [ ] Next.js MCP Client实现
- [ ] 大模型接入

### 阶段3：功能集成
- [ ] MCP服务器连接测试
- [ ] 工具调用流程验证
- [ ] 图表生成和展示
- [ ] 完整工作流程测试

### 阶段4：优化和完善
- [ ] 用户界面优化
- [ ] 性能优化
- [ ] 错误处理
- [ ] 文档完善

## 预期成果

1. **技术成果**
   - 基于Spring AI的Neo4j MCP Server
   - 基于Spring AI的EChart MCP Server
   - Next.js MCP Client实现
   - 完整的MCP工具调用系统

2. **应用成果**
   - 智能检索和关系分析系统
   - 知识图谱构建和查询
   - 图表可视化分析
   - 智能问答系统

3. **学术成果**
   - 毕业设计论文
   - 系统架构设计文档
   - 技术实现方案

## 技术难点

1. **MCP协议实现**
   - 理解MCP协议规范
   - 实现标准化的工具调用
   - 处理异步调用和错误

2. **关系分析**
   - 从文本中提取实体和关系
   - 构建知识图谱
   - 优化查询性能

3. **图表HTML生成**
   - **图表类型层**：根据规范化数据生成ECharts配置JSON
     - 数据验证和格式转换
     - 不同图表类型的配置生成逻辑
     - 配置JSON的标准化格式
   - **HTML生成层**：将ECharts配置JSON转换为HTML
     - HTML模板设计和生成
     - ECharts库的引入和初始化
     - 配置JSON的嵌入和渲染
   - 在Next.js中展示HTML图表

4. **系统集成**
   - 多个MCP服务器的协调
   - 工具调用的顺序和依赖
   - 错误处理和回滚

## 参考资料

- [MCP协议规范](https://modelcontextprotocol.io)
- [Spring AI文档](https://docs.spring.io/spring-ai/reference/)
- [Neo4j官方MCP](https://github.com/neo4j/mcp)
- [Next.js文档](https://nextjs.org/docs)
- [EChart文档](https://echarts.apache.org/)
