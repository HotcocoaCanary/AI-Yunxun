# Client 模块框架设计与前端界面

本文件仅描述目标导向的设计，不涉及代码实现细节。

## 设计目标

- 以“添加与管理 MCP 工具”为核心能力。
- 对话是主入口，工具调用过程应可视化与可追溯。
- 模型记忆保持简单：可持久化、可回放、无用户体系依赖。
- 界面清晰、状态明确，不追求复杂功能。

## Client 模块框架（抽象分层）

1) **交互层（对话与工具管理）**  
处理对话输入、工具导入与管理操作。

2) **模型层（LLM 交互）**  
负责对话调用、工具调用与结果回传。

3) **MCP 连接层**  
维护 MCP 连接、工具列表与调用生命周期。

4) **记忆层（聊天记录）**  
使用 MongoDB 持久化记录，按 `conversationId` 归档。

5) **可观测层（日志与状态）**  
接收 MCP logging 通知并生成“调用中/成功/失败”状态。

## MCP 工具管理（面向目标的能力）

- **导入**：支持 Claude Desktop `mcpServers` JSON。
- **管理**：列出、启停、移除外部 MCP 服务。
- **识别**：以服务器名称作为显示标识。
- **兼容性**：以 STDIO 为基础，后续可扩展 SSE/Streamable-HTTP。

## 模型记忆（简单但可持续）

- **会话标识**：`conversationId` 由前端生成并持久化（如本地存储）。
- **记忆策略**：默认保留最近 N 条上下文 + MongoDB 持久化存档。
- **保留策略**：可配置 TTL 或永久保存（用于论文复现）。
- **已知限制**：工具调用中间消息可能无法进入记忆（需在论文中说明）。

## 工具调用与状态展示

### 状态目标

- “正在调用哪个工具”
- “调用成功/失败”
- “失败原因可追溯”

### 推断策略（基于现有日志）

- `logger=echart-tool` / `logger=neo4j-tool` 作为工具域识别。
- `level=ERROR` → 失败
- `message` 含“开始” → 调用中
- `message` 含“完成/成功” → 成功

可选的统一日志前缀（未来增强）：
`[tool=<toolName>] [phase=begin|progress|done|error] <message>`

## 前端界面设计（结构与信息层级）

### 页面结构

- **主区：对话面板**  
输入、输出、当前会话状态。

- **侧区：工具与状态**  
当前工具列表、工具调用状态。

- **日志区**  
按时间流展示 MCP 日志，支持“失败高亮”。

- **图表区**  
若工具返回可视化结果，进行直观展示。

### 关键交互

- “导入 MCP 配置（JSON）” → 预览 → 启用
- “启停工具” → 立刻生效
- “新建会话” → 生成新 `conversationId`

## 非目标（当前阶段不做）

- 用户体系 / 权限体系
- 多租户管理
- 复杂的工作流编排或多智能体协作
- 大规模数据检索与向量数据库整合

## 成果要求（论文导向）

- 能稳定导入与管理 MCP 工具
- 能记录工具调用过程与结果状态
- 能持久化对话记录并可回放
