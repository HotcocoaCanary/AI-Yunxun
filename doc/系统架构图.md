# 系统架构图

下面是基于当前系统模块的架构图，展示主要组件和数据流。

```text
用户
  |
  | 1) 输入问题
  v
前端界面 (Next.js)
  |
  | 2) POST /api/chat (SSE)
  v
MCP Client + 领域服务
(mcp/client)
  |\
  | \ 3) 请求智谱模型 (glm-4.7-flash)
  |  \-----------------------> 智谱开放平台
  |
  | 4) tool_calls -> MCP 调用
  |-------------------------> MCP Server: Neo4j (SSE)
  |                           - schema/read/write
  |                           - APOC 支持
  |
  |-------------------------> MCP Server: ECharts (SSE)
  |                           - generate_graph_chart
  |
  | 5) 工具结果 -> 回填模型
  |
  | 6) SSE 流式返回
  v
前端界面渲染
  - 文本回复
  - 工具调用卡片
  - ECharts 图表
```

模块与目录对应关系：

- MCP Client + 领域服务：`mcp/client`
  - 领域服务：`mcp/client/src/domain`
  - MCP 客户端：`mcp/client/src/infra/mcp`
  - 模型调用：`mcp/client/src/infra/zhipu`
  - SSE 接口：`mcp/client/src/app/api/chat/route.ts`
  - 前端界面：`mcp/client/src/ui`、`mcp/client/src/app`
- MCP Server（Neo4j）：`mcp/server/neo4j`
- MCP Server（ECharts）：`mcp/server/echart`
